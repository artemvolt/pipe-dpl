# Установка
~~~
git clone https://github.com/pozitronik/bc.git
cd bc
composer install
~~~
подключаем БД в web.php
~~~
yii migrate --migrationPath=@vendor/pozitronik/yii2-users-options/migrations
yii migrate --migrationPath=@vendor/pozitronik/yii2-options/migrations
yii migrate --migrationPath=@vendor/pozitronik/yii2-exceptionslogger/migrations
yii migrate
yii service/init
~~~

Вход - admin/admin

# Соглашения по структуре
## Всему своё место:

**assets** - глобальные ассеты: модели и ресурсы (смотрим, как сделано, делаем так же).<br />
**commands** - глобальные консольные контроллеры. Пока кладём все вместе, если будет много — разделим.<br />
**config** - все конфиги. Если понадобится сделать конфиг для отдельной сущности, выносим его в отдельный файл для удобства подключения.<br />
**controllers** - глобальные web-контроллеры.<br />
**models** - глобальные модели, разделённые по подкаталогам по назначению:

*    **core** - внутренние штуки для разработки: отладчики, обслуживание.
*    **site** - модели веб-приложения, например, авторизация.
*    **sys** - системные модели приложения.

**modules** - составные части приложения, изолированные друг от друга (но не глобально).
**views** - вью. Соблюдаем декларации фреймворка: название файла вью совпадает с именем экшена и лежит в подкаталоге с именем контроллера. Для модальных вью создаём подкаталог.<br />
**widgets** - глобальные виджеты. Смотрим, как сделано, делаем аналогично.<br />

## Стараемся изолировать все сущности.
**Ассеты**: ресурсы каждого ассета дробим по файлам по понятной логике. Стили, например, выносим в разные css, каждый из которых описывает свою часть интерфейса; объединяем ресурсы уже в модели ассета.
**Контроллеры**: контроллер отвечает только за связанную модель. Скажем, если это UsersController, то в нём должно быть **только** управление пользователями, но не пользовательскими сущностями, например.<br />
С ajax-экшенами попробуем делать так:
1) Сначала пытаемся объединить с обычным методом через isAjax:
```php
public function actionProfile(int $id):?string {
    if (null === $user = Users::findModel($id, new NotFoundHttpException())) return null;
    if (Yii::$app->request->isAjax) {
        return $this->renderAjax('modal/profile', [
            'model' => $user
        ]);
    }
    return $this->render('profile', [
        'model' => $user
    ]);
}
```
2) Если объединить нельзя (поведение различается) или не с чем (метод есть только в ajax-версии), делаем его в том же контроллере.
3) Если аяксовой логики слишком много, делаем отдельный контроллер с ajax-суффиксом, например UsersAjaxController. 

**Модели**: всё, что отвечает за взаимодействие с одной сущностью, отделяем в подкаталог, там уже создаём модели, каждая из которых отвечает за один аспект работы. Например:<br />
/users/Users.php - ActiveRecord-класс взаимодействия с БД, но НЕ логика операций самих пользователей.<br />
/users/UsersProcess.php - логика работы пользователей.<br />
/users/UsersSearch.php - поисковая модель пользователей.<br />

Хелперы и трейты, связанные с сущностью, располагаем в том же подакаталоге (не возбраняется выделять их в подкаталоги /helpers и /traits), именуем с соответствующими постфиксами: UsersHelper.php, UsersTrait.php

**Модули**: каждый модуль рассматриваем, как мини-приложение, к которому применяются те же правила изоляции внутренностей.

# Фичи по коду
Описываем фичи (модули, классы, хелперы, полезняшки, подходы), которые принесли в проект, чтобы знал каждый.<br />

**Работа с модалками**: подключаем ModalHelperAsset, получаем js-методы LoadModal() и AjaxModal():
**LoadModal()**: загружает в тело существующей модалки новый контент из renderAjax-вью.<br />
**AjaxModal()**: загружает renderAjax-вью в контейнер с прелоадером (контейнер создастся, если не существует).

**Системные настройки**: @vendor/pozitronik/yii2-options/src/models/SysOptions.php<br />
Штука для хранения key-value параметров в БД с промежуточным кешированием. Предназначена для выноса параметров из конфига, например, для изменения через интерфейс. Вся дока внутри.

**Пользовательские настройки**: @vendor/pozitronik/yii2-users-options/src/models/UsersOptions.php<br />
Штука для хранение key-value per user параметров в БД с промежуточным кешированием. Этакие серверные кукисы.